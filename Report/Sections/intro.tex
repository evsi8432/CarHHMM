% !TeX root = ../main.tex

Biologging technology now provides researchers with kinematic data collected almost continuously in time \citep{Hooten:2017}.
The collection and analysis of data from devices such as accelerometers have brought new insights to areas ranging from monitoring machine health \citep{Getman:2009} to understanding physical activity levels in children \citep{Morris:2007}. The study of animal movement in particular has been transformed by tracking devices that record kinematic information in a variety of environments \citep{Borger:2020,Dot:2016b}. Tags can record over 50 observations per second, resulting in time series containing millions of observations over the course of several hours. %These data contain a wealth of information about human and animal behaviour, but parsing these large data sets poses a challenge for statisticians and biologists. 
These data contain a wealth of information about human and animal behaviour, but modelling these large data sets poses a challenge for statisticians and biologists. One particular difficulty is that simultaneous coarse- and fine-scale processes are often reflected in high-frequency data, and each scale can exhibit unique and complicated structure.

Biologging data are frequently modelled as a set of curves and analyzed using methods of Functional Data Analysis, or FDA -- see, e.g., \citet{Ramsay:2005}. For example, \citet{Morris:2007} view a child's activity level as a set of daily curves where metabolic activity is a function of time. Similarly, \citet{Fu:2017} view the dive profile of a southern elephant seal (\textit{Mirounga leonina}) as a set of dive curves whereby the amplitude and phase variation of the dive is used to classify dive types.

FDA was originally developed to process curves assumed to be independent replicates (i.e., there is no between-curve dependence), and within-curve fine-scale structure is not usually incorporated in FDA models. However, sets of curves often exhibit complex sequential dependencies both between curves and within curves, especially in the case of biologging data \citep{Barajas:2017}.
On a coarse scale, dive profiles of marine animals show a discrete number of distinct dive ``types"
%that aggregate together in time 
where the sequence of dive types exhibits state-switching behaviour \citep{Tennessen:2019b}. On a fine scale, these profiles can display bouts of short-term periodicity within each dive \citep{Adam:2019}. Fine-scale periodicity nested within a coarser state-switching process is also common in fields ranging from machine health \citep{Xin:2018,Lucero:2019} to speech recognition \citep{Juang:1991}. 

Some FDA models account for between-curve dependence that occurs when multiple curves arise from separate groups of individuals, but these models are inadequate when modelling certain kinds of dependence in time. For example, previous studies have used multilevel models with random effects to model variation between and within individuals in daily activity levels of children \citep{Morris:2007} or in menstrual cycles of adults \citep{Bromback:1998}. More recent work involving multilevel models includes that of \citet{Di:2009}, \citet{Crainiceanu:2009}, and \citet{Chen:2012}. %However, these multilevel models are not appropriate in many biologging applications since they do not account for a discrete number curve types. 
However, the first two papers do not account for temporal between-curve dependence and the third paper's model of temporal dependence assumes that curves evolve smoothly in time. This is not appropriate in many biologging applications where behaviours often change suddenly between a discrete number of types.
In addition to multi-level models, FDA researchers have used functional time series to model dependence in a sequence of curves. Functional time series extend the ideas of classic time series to model the evolution of one curve into the next \citep{Kokoszka:2018}, but they do not account for sequences of time-series curves whose distributions are determined by a discrete number of well-defined hidden states.

Traditional FDA techniques similarly fall short when modelling complicated within-curve data. In particular, within-curve structure is usually modelled by a generic smooth mean function and a covariance function \citep{Yao:2005} or with random regression \citep{Rice:2001}. However, time-series data exhibiting both sharp behavioural changes and periodic fine-scale structure are difficult to model with these classic FDA techniques.

Our goal is to identify and describe discrete behavioural states at multiple scales within functional data (e.g., coarse-scale curve types and fine-scale behavioural states) and to model the dependence structure between those states. To accomplish this, we turn to the field of animal movement modelling \citep{Hooten:2017}, where one of the most prevalent techniques of late is the hidden Markov model, or HMM \citep{Patterson:2017,McClintock:2020}. HMMs interpret animal movement data as arising from a Markov chain of a discrete number of behavioural states, allowing biologists to infer the underlying behaviour of an animal from sequential observations of its position. While ubiquitous in ecology literature, HMMs have seen little use in non-parametric functional modelling with a few notable exceptions. In particular, \citet{Langrock:2018} take a non-parametric approach to model the distributions of HMM observations with B-splines, while \citet{DeSouza:2014} and \citet{DeSouza:2017} use HMMs to model state-switching behaviour within functional data. However, none of these papers account for temporal correlation taking place on multiple scales. 

While useful, HMMs alone are also not sufficient to model high-frequency time-series data for three primary reasons.
Firstly, classic HMMs fail to model simultaneous behavioural processes that occur at different time scales (e.g., both between and within curves). To address this issue, statistical ecologists have employed hierarchical hidden Markov models (HHMMs) \citep{Barajas:2017,Adam:2019}, which model both scales with conditionally dependent HMMs.
Secondly, HMMs assume that subsequent observations are independent given an underlying hidden state process, but this is often not the case when observations are taken at extremely high frequencies. Several solutions have been proposed in the ecology literature, including the hidden movement Markov model \citep{Whoriskey:2016} and the conditionally auto-regressive hidden Markov model, or CarHMM \citep{Lawler:2019}. 
Thirdly, traditional HMMs, CarHMMs, and HHMMs cannot easily capture complicated dependence structures on short time scales. For example, \citet{Adam:2019} fail to capture fine-scale periodic swimming pattern of horn sharks (\textit{Heterodontus francisci}) using a traditional HHMM. \citet{Heerah:2017} successfully use Fourier analysis within an HMM to account for daily behavioural cycles in marine mammals, and Fourier analysis has previously been used with accelerometer data to explain animal behaviour \citep{Fehlmann:2017,Shorter:2017}. Thus, incorporating Fourier analysis within the structure of an HMM appears to be a promising approach to account for fine-scale periodic structures in biologging data.

We combine these existing methods from statistical ecology literature in novel ways to classify and describe state-switching behaviours in functional data while accounting for complex temporal dependence. The resulting suite of methods makes up a ``tool box" that can be used to build arbitrarily complex hierarchical models to explain multi-scale functional and time-series data with intricate dependence structure.
We begin in Section 2 by describing HMMs as well as two variants, CarHMMs and HHMMs, and discuss how summary statistics over moving windows can handle fine-scale dependence structures. We also show how these methods can be combined to analyze increasingly complex data. In Section 3 we fit several candidate models to data from a killer whale (\textit{Orcinus orca}) from the threatened northern resident population off the coast of British Columbia, Canada. Section 4 details a simulation study based on these candidate models, and in Section 5 we discuss our results.