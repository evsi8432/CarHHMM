% !TeX root = ../main.tex

Biologging technology now provides researchers with data collected almost continuously in time \citep{Hooten:2017}.
The collection and analysis of data from devices such as accelerometers has brought new insights to areas ranging from monitoring machine health \citep{Getman:2009} to understanding physical activity levels in children \citep{Morris:2007}. In particular, the study of animal movement has been transformed by advanced tracking devices which collect biologging data \citep{Borger:2020}. Tags can record observations at over 50 times per second, resulting in time series containing millions of observations over the course of several hours. These data contain a wealth of information about human and animal behaviour, but parsing these large data sets poses a new challenge for statisticians.

Biologging data are frequently modelled as a set of curves analyzed by methods of Functional Data Analysis (FDA, see, e.g., \citet{Ramsay:2005}). For example, \citet{Morris:2007} view a child's activity level throughout the day as a curve where metabolic activity is a function of time. Similarly, \citet{Fu:2017} view the dive profile of elephant seal (\textit{Mirounga leonina}) as a sequence of dive curves whereby the amplitude and phase variation of the dive is used to classify dive types.
%, although they ignore sequential dependence between dives. 
%Similarly, our case study views the dive profile of a killer whale (\textit{Orcinus orca}) as a sequence of curves where three orthogonal axes of acceleration are each functions of time.
%
FDA was originally developed to process curves assumed to be independent replicates, but time series data of this type are often complicated by dependencies which violate this assumption. In particular, biologging data often display significant temporal dependence both between curves (coarse-scale) and within curves (fine-scale) \citep{Barajas:2017}.
%, as is the case for our case study data. Namely, the dive profile (see Figure \ref{fig:data}) of a killer whale from the threatened northern resident population off the coast of British Columbia, Canada, clearly shows temporal dependence between dives, as dives of various time durations and depths appear to be clustered together in time. 
For example, marine mammal dive profiles show distinct dive ``types" that appear to cluster together in time  \citep{Tennessen:2019b} while simultaneously displaying bouts of short-term periodicity within dives \citep{Adam:2019}. Fine-scale periodicity within a larger process in particular is also common in fields ranging from machine health \citep{Xin:2018,Lucero:2019} to speech recognition \citep{Juang:1991}.

%In addition, \citet{Lucero:2019} attach accelerometers to railway axles to detect cracks. The raw acceleration data exhibit extreme periodicity (in the form of vibration) that depends upon the behaviour of the train as the load and speed of the train change. %To model between-curve dependence in dive profiles, previous studies have categorized killer whale (\textit{Orcinus orca}) dives into different types associated with specified behaviours such as resting, travelling, and foraging \citep{Tennessen:2019b}.
%Figure {\ref{fig:labeled_dives}} also shows clear temporal dependence within dives, as the accelerometer data within each dive indicate bouts of short-term periodicity. 
%Behaviourally dependent periodicity is not unique to the biologging data- in the field of machine health, \citet{Lucero:2019} attach accelerometers to railway axles to detect cracks. The raw acceleration data exhibit extreme periodicity (in the form of vibration) that depends upon the behaviour of the train as the load and speed of the train change.

Some FDA models account for between-curve dependence but are inadequate when modelling certain types of time dependencies. %, including that of Figure \ref{fig:data}.
For example, 
%multilevel models incorporate dependence via random effects. 
Previous studies have used multilevel models with random effects to capture variation between activity levels in children \citep{Morris:2007} and study differences in menstrual cycles \citet{Bromback:1998}. More recent work involving multilevel models includes that of \citet{Di:2009}, \citet{Chen:2012} and \citet{Crainiceanu:2009}. However, multilevel models are not appropriate in many biologging applications since they account for neither temporal dependence nor different curve types. 
%In the aforementioned study of children's activity levels \citep{Morris:2007}, the authors used a multilevel approach with a random effects to model variation between children. In a classic paper that introduced this multilevel structure,  \citet{Bromback:1998} used cubic splines in a mixed effects model to study menstrual cycles. More recent work on multilevel models includes that of \citet{Di:2009}, \citet{Chen:2012} and \citet{Crainiceanu:2009}. However, multilevel models are not appropriate in many biologging applications since they account for neither temporal dependence nor different curve types. 
In addition to multilevel models, FDA researchers have also used functional time series to model dependence in sequences of curves. Functional time series extend the ideas of classic time series to model the evolution of one curve into the next \citep{Kokoszka:2018}. %While functional time series methods can in theory be applied to biologging data such as ours, 
However, functional time series do not account for sequences of time series curves that switch between a discrete number of well defined states.
%
Traditional FDA techniques similarly fall short when modelling complicated within-curve %acceleration 
data. In particular, within-curve structure is usually modelled by a generic smooth mean function and a covariance function \citep{Yao:2005} 
%use this framework to construct a method of sparse longitudinal data analysis using functional principal component analysis. Alternatively, within-curve structure is sometimes generated 
or via random regression \citep{Rice:2001}. 
%For example, \citet{Rice:2001} use random regression to construct non-parametric mixed effects models for unequally sampled noisy curves. However, the combination of apparent behavioural changes combined with periodic behaviour makes accelerometer data such as ours difficult to model with these classic FDA techniques.
However, time series data exhibiting both sharp behavioural changes and periodic fine-scale structure is difficult to model with these classic FDA techniques.

In light of these challenges, we turn to the field of
%methodology for the analysis of animal movement 
%statistical ecology
animal movement modelling \citep{Hooten:2017}, where one of the most prevalent techniques of late is the hidden Markov model, or HMM \citep{Patterson:2017,McClintock:2020}. HMMs interpret animal movement data as arising from different types of unobserved behavioural states, allowing biologists to infer the underlying behaviour of an animal from observations of its position. While ubiquitous in ecology literature, HMMs have seen little use in non-parametric functional modelling, with a few notable exceptions. In particular, \citet{Langrock:2018} take a non-parametric approach to model the distributions of HMM observations with B-splines, 
%This is useful for both incorporating covariates and flexibly describing complex data, since these functions are non-parametric and take covariates as arguments. 
but this approach does not account for certain types of time correlation within or between individual time series.

While useful, HMMs alone are also not sufficient to model intricate fine-scale time series data for three primary reasons.
%
Firstly, HMMs assume that subsequent observations are independent given an underlying hidden state process, but this is often not the case when observations are taken at extremely high frequencies. 
Several solutions have been proposed in the ecology literature such as the hidden movement Markov model \citep{Whoriskey:2016} and the conditionally auto-regressive hidden Markov model, or CarHMM \citep{Lawler:2019}. The CarHMM in particular explicitly models auto-correlation into an HMM while largely maintaining its base structure. 
%
Secondly, classic HMMs fail to model simultaneous behavioural processes that occur at different time scales, (i.e., between and within curves). 
To deal with this issue animal movement modellers have employed hierarchical hidden Markov models (HHMMs) \citep{Barajas:2017,Adam:2019}, which model processes at both scales with conditionally dependent HMMs.
%
Finally, traditional HMMs, CarHMMs, and HHMMs cannot easily capture complicated dependence structures at short time scales. For example, \citet{Adam:2019} fail to capture fine-scale periodic swimming pattern of horn sharks (\textit{Heterodontus francisci}) using a traditional HHMM. \citet{Heerah:2017} use Fourier analysis within an HMM to account for %periodic behaviour in the context of describing 
daily behavioural cycles in marine mammals. In addition, Fourier analysis has previously been used with accelerometer data to explain animal behaviour \citep{Fehlmann:2017,Shorter:2017}. Thus, incorporating Fourier analysis within the structure of an HMM appears to be a promising approach to account for fine-scale periodic structures.

%While animal movement modellers have taken steps to solve each of these issues independently, to our knowledge there is no unifying framework combining the three together. 
In this paper, we combine existing methods from statistical ecology literature in novel ways to account for complex temporally dependent functional data. The resulting suite of methods make up a ``tool box" that can be used to build arbitrarily complex hierarchical models to model multi-scale functional and time-series data with intricate dependence structure.
%and thus extend the methods available for the analysis of functional data. 
We begin by describing HMMs as well as to two variants (CarHMMs and HHMMs) and discuss how Fourier analysis can handle fine-scale dependence structures. We also show how these methods can be combined to analyze increasingly complex data. In Section 3 we present a case study in which we fit several candidate models to data from a killer whale from the threatened northern resident population off the coast of British Columbia, Canada. Section 4 details a simulation study based on these candidate models, and in Section 5 we discuss our results.