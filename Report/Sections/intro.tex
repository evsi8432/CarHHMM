Tracking technology now provides researchers with data collected almost continuously in time \citep{Hooten:2017}.
The collection and analysis of data from devices such as accelerometers has brought new understanding to areas ranging from monitoring machine health \citep{Getman:2009} to understanding physical activity levels in children \citep{Morris:2007}. In particular, the study of animal movement has been transformed by tracking devices that collects biologging data (CITATION). Tags attached to animals can record observations at rates of tens of hertz, resulting in time series containing millions of observations over the course of several hours. These data provide biologists with a wealth of knowledge about animal behaviour, but parsing this vast amount of information is a challenge for statisticians.

%Many statistical techniques have been developed and applied to these types of longitudinal or functional data.  
%Some techniques, such as time series, are highly parametric. 
%While these parametric techniques do not allow the data to ``speak for itself", the ensuing data analysis results typically are readily interpretable, providing important subject area insights.
%At the other extreme are black box type methods of machine learning.  
%While these methods are incredibly successful at predicting how processes evolve, they provide little structured insight into the driving mechanisms of the process.
%Functional Data Analysis (FDA) techniques lie somewhere in between these extremes: the output of an analysis provides visual tools for understanding processes and, often, some dimension reduction to allow for easier exploration.  
%The development of structured FDA techniques which incorporate more complex dependence structures has become a topic of recent interest  (see, e.g., Crainiceanu. and references therein).

Movement data are sometimes modelled as a set of curves that can be analyzed by methods of Functional Data Analysis (FDA, see, e.g., \citealt{Ramsay:2005}). In \cite{Morris:2007}, a child's activity level throughout the day is viewed as a curve where metabolic activity is a function of time. The dive profile of marine mammals can be viewed as a curve, and Fu (CITATION) showed that [methods used by Eric and Nancy] is useful to classify [blah blah blah]. However, now many such animals are tracked with multiple devices providing information at different scales. For example, in our case study, a single dive of a killer whale (\textit{Orcinus orca}) can be viewed as having several curves where acceleration and depth are functions of time.

FDA was originally developed for curves that can be considered independent replicates, but the structure of time-series data is often complicated by additional dependencies. In particular, biologging data often display significant temporal dependence both between curves (coarse-scale) and within curves (fine-scale) (CITATION would be good - Fu's discussion? Our Vianey's paper or Timo Adam's paper?). Our case study data clearly demonstrate this common additional dependencies between curves. The dive profile (Figure \ref{fig:data}A) of a killer whale from the threatened Northern resident population off the coast of British Columbia, Canada (see Section \ref{sec:data} for more information about data collection and preprocessing) clearly shows temporal dependence \textit{between} dives, as dives of various time durations and depths appear to be clustered together in time. Previous studies have categorized these dives into different types, each associated with a different behavior, including resting, traveling, or foraging \citep{Tennessen:2019b}.
Figure {\ref{fig:labeled_dives}} also shows clear temporal dependence \textit{within} dives, as the accelerometer data within each dive indicate bouts of short-term periodicity. The combination of apparent behavioral changes combined with periodic behavior makes this accelerometer data difficult to model using simple stochastic processes. [Here if you can say something about how common this combined periodicity and behavioral dependece is in other accelerometer data, e.g. in human with a citation, you'd really effectively broaden the generality of the problem.]

The FDA literature provides models that account for some between-curve dependence structures, but these methods are not adequate for modelling the coarse-scale temporal structure seen here. For example, multilevel models incorporate dependence via random effects. In the aforementioned study of children's activity levels \citep{Morris:2007}, the authors use a multilevel approach since each child yields two daily activity curves; the model includes a random effect for ``child''. In a classic paper that introduced this multilevel structure,  \cite{Bromback:1998} used cubic splines in a mixed effects model to study menstrual cycles. More recent work on multilevel models includes that of \cite{di:2009}, \cite{chen:2012} and Crainiceanu [REF]. However, multilevel models are not appropriate for this killer whale data since they account for neither the temporal dependence in the dive sequence nor the different dive types. 
In addition to multilevel models, FDA researchers have used functional time series to model dependence in sequences of curves. Functional time series extend the ideas of classic time series to model the evolution of one curve into the next \citep{Kokoszka:2018}. While functional time series methods can in theory be applied to our dive data, they do not account for the discrete number of different dive types.
 
Traditional FDA techniques similarly fall short when modelling the within-curve acceleration data seen here. In particular, within-curve structure is usually modelled by a generic smooth mean function and a covariance function (e.g., CITATION- an example with accelerometer data would be particularly good - just did a quick search and they may not be appropriate but could look at: https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0169576 or https://academic-oup-com.ezproxy.library.ubc.ca/biostatistics/article/16/2/352/266114). Alternatively, this structure is sometimes generated via random regression.  Radically changing behavior that we see in the accelerometer data of similar to our dive sequence would be challenging to modelled with these classic FDA techniques.

In light of these challenges, we turn to vast field of methodology for the analysis of animal movement \citep{Hooten:2017,Mcclintock:2020}, where one of the most prevalent techniques in the literature of late is the hidden Markov model, or HMM \citep{Patterson:2017}. HMMs interpret animal movement data as arising from different types of unobserved behavioural states, allowing biologists to infer the underlying behaviour of the animal from movement observations. The ubiquitous applications of HMMs in ecology have seen little use in FDA, with a few notable exceptions. In particular,  \citet{Langrock:2018} did [blah blah blah], which does not deal with [blah blah blah]. We show here how HHMs can provide a new tool to the FDA toolbox.

%
%Importantly, under the traditional HMM model, subsequent observations are assumed to be independent from one another when conditioned on the underlying behavioural process.
%However, this assumption is often violated in the real world processes, especially when observations are taken a high frequencies. 
%For example, the location of an animal at a given time is highly correlated with the location of that animal one second later. 
%Several publications have dealt with this issue in the past, including the hidden movement Markov model \citep{Whoriskey:2016} and the conditionally auto-regressive hidden Markov model, or CarHMM \citep{Lawler:2019}. 
%The CarHMM in particular explicitly models auto-correlation into an HMM in a way that is easily analyzed using usual HMM techniques.
%while maintaining the structure needed to run the forward algorithm. 
%It also only adds one additional parameter per possible hidden state.

Under the traditional HMM, observations are independent given the underlying hidden state process. However, this assumption is often violated in real-world processes, especially when observations are taken at high frequencies. Several solutions have been proposed in the ecology literature, such as the hidden movement Markov model \citep{Whoriskey:2016} and the conditionally auto-regressive hidden Markov model, or CarHMM \citep{Lawler:2019}. The CarHMM in particular explicitly models auto-correlation into an HMM while adding minimal complexity to the base structure of an HMM. Animal movement modelers have used hierarchical hidden Markov models (HHMMs) to model simultaneous behavioural processes that occur at different time scales \citep{Barajas:2017,Adam:2019}. We borrow from ideas from both the CarHMM and the HHMM here.

Traditional HMMs, CarHMMs, or HHMMs cannot easily capture the complicated structure that biologging data often exhibit at short time scales. For example, the HHMM of \citet{Adam:2019} did not capture the fine-scale periodic swimming pattern of  horn sharks (LATIN NAME). However, \citet{Heerah:2017} have demonstrated the advantages of using Fourier analysis within an HMM to account for periodic behavior in the context of describing daily behavioural cycles of marine mammals. In addition, Fourier analysis has previously been used on accelerometer data to explain animal behaviour \citep{Fehlmann:2017,Shorter:2017}. Thus, incorporating Fourier analysis of accelerometer data within the structure of an HMM appears to be a promising approach to account for periodic structures in fine-scale data.

In this paper, we unify and build off of several existing methods from the ecology literature in novel ways to account for complex temporally dependent functional data. The resulting suite of methods make up a ``tool box" that can be used to build arbitrarily complex hierarchical models and solve FDA problems.
%This work investigates how to incorporate fine-scale processes into the larger structure of hierarchical hidden Markov models while maintaining computational efficiency. 
%We describe a general procedure that can be used to extract features from highly structured fine-scale behaviours that otherwise could not be modeled with existing HMM models. 
%In addition, we bridge the gap between the discrete CarHMM and certain continuous-time stochastic process models by showing that the two are equivalent under certain conditions. 
%We then perform a simulation study to compare the performance of each existing model with ours in a controlled setting.

In this paper, we first describe HMMs in addition to two variants (CarHMMs and HHMMs) and discuss  how Fourier analysis can handle fine-scale dependence structures. We also show how these methods can be combined to analyze increasingly complex data. In Section 3, we construct several candidate models to describe the data from Figure \ref{fig:data}. Section 4 details a simulation study based on these candidate models. In Section 5, we fit the candidate models to the original data, and in Section 6 we discuss the results.