% !TeX root = ../main.tex

%\section{Killer Whale Case Study}

%In order to test the advantages of the CarHHM-DFT over the other models on real-world data, we used the four models described in the simulation study to analyze dive data from a Northern Resident Killer Whale (NRKW) off the coast of British Columbia, Canada. 

%\section{Results}

After fitting the four candidate models to simulated data, we repeat the same exercises and fit all four models to the data shown in Figure \ref{fig:data}. Here we report the results from the full CarHHMM-DFT defined in Section \ref{sec:data} in detail and asses the quality of the fit. We also compare the results of the CarHHMM-DFT with the other candidate models.

The estimates for the emission distribution parameters suggest that the killer whale has at least two distinct dive behaviours (Table \ref{table:emis_dists_CarHHMM-DFT}, Figure \ref{fig:coarse_emis}). 
Dive type 1 corresponds to shorter, shallower dives. Ecologists have attributed a variety of purposes to such short dives, including resting, traveling, and searching for prey \citep{Tennessen:2019a}.
Dive type 2 is longer and deeper. These types of deep sustained dives have been associated with behaviours such as foraging and socialization in killer whales \citep{Tennessen:2019a,Tennessen:2019b}. However, \citet{Wright:2017} note that most prey captures occur at depths deeper than 100m, so it is unlikely that any of the 267 dives used in this study are successful foraging dives.

The three subdive behaviours have distinct $Z^{*2}$ values, as the means of each are separated by an order of magnitude. (Table \ref{table:emis_dists_CarHHMM-DFT}, Figure \ref{fig:fine_emis}). 
Subdive state 1 has the smallest mean $Z^{*(2)}$ and the smallest variance of $Z^{*(1)}$. It also has the highest auto-correlation in $Z^{*(1)}$. This corresponds to less overall activity and more consistent acceleration compared to the other subdive states. 
Subdive type 2 has a mean Fourier sum ($Z^{*(2)}$) one order of magnitude higher than subdive state 1, and its acceleration has about twice the variance compared to subdive state 1. The auto-correlation of acceleration is also slightly lower in this state. We hypothesize that subdive type 2 corresponds to fluking (active swimming), as strong sinusoidal behaviour in acceleration is characteristic of this behaviour in marine mammals \citep{Simon:2012}.
The mean of $Z^{*(2)}$ and variance of $\mathbf{Z}^{*(1)}$ in subdive state 3 is much higher than the other two states. The auto-correlation of $\mathbf{Z}^{*(1)}$ is also much lower, implying more variation in acceleration between consecutive segments. This corresponds to vigorous swimming activity, especially as the killer whale begins a dive or surfaces from a dive (see Figure \ref{fig:labeled_dives}). 

The estimated probability transition matrices and associated stationary distributions are
%
$$\hat \Gamma = \begin{pmatrix} 
0.788 & 0.212 \\
0.809 & 0.191
\end{pmatrix},$$
$$\hat \delta = \begin{pmatrix} 0.792 & 0.208 \end{pmatrix},$$
%
for the transitions from dive to dive. For dive types 1 and 2,
$$\hat \Gamma^{*(1)} = \begin{pmatrix} 
0.679 & 0.321 & 0.000 \\
0.038 & 0.904 & 0.058 \\
0.000 & 0.232 & 0.768
\end{pmatrix}, \qquad 
\hat \Gamma^{*(2)} = \begin{pmatrix} 
0.859 & 0.141 & 0.000 \\
0.114 & 0.841 & 0.045 \\
0.000 & 0.216 & 0.784
\end{pmatrix},$$
$$\hat \delta^{*(1)} = \begin{pmatrix} 0.087 & 0.731 & 0.182 \end{pmatrix}, \enspace \text{and} \enspace \hat \delta^{*(2)} = \begin{pmatrix} 0.401 & 0.496 & 0.103 \end{pmatrix}$$
%
for the fine-scale within-dive transitions.
The estimated coarse-scale stationary distribution, $\hat{\delta}$, indicates that most dives are short type 1 dives. The estimated coarse-scale transition probability matrix $\hat \Gamma$ further indicates that the whale usually performs multiple short type 1 dives before doing only one (or a few) long type 2 dive. This finding is consistent with those of \citet{Tennessen:2019b} and \citet{Williams:2009}, both of whom describe common bouts of short dives before a killer whale performs a longer, deeper dive. The fine-scale stationary distributions $\hat{\delta^{*(i^*)}}$ indicate that this killer whale is more likely to be in the less active subdive state 1 when performing long deep dives than when performing short shallow dives. Using less active swimming behaviour is consistent with the need for marine mammals to conserve energy when diving at depth and holding breath for long periods of time \citep{Williams:1999,Hastie:2006}. Figure \ref{fig:labeled_dives} shows the decoded dive behaviour of 6 selected dives. The supplementary material also shows the estimated probability of each dive and subdive state given the data (Section S-2.2).

\subsection{Model Validation}
\label{subsec:model_validation}

Two visual tools were used to evaluate this model: pseudo-residuals and empirical histograms. A pseudo-residual of a particular observation is the marginal cumulative distribution function of an observation conditioned on all other observations under the learned model \citep{Zucchini:2016}. To easily visualize outliers, this pseudo-residual is often passed through the quantile function of the standard Normal distribution. Mathematically, the pseudo-residual of an observation $y_t$ in a traditional HMM is equal to $\Phi^{-1} \left(Pr(Y_t < y_t|\{Y_1,\ldots,Y_T\}/\{Y_t\}) \right)$, where $\Phi$ is the cumulative distribution function of a standard Normal distribution. If the model is correct, then all pseudo-residuals are independent and follow a standard Normal distribution. We find that histograms of the pseudoresiduals of this model mostly support that the model is well-specified. One exception is $Z^{*(2)}$, whose pseudo-residuals are noticeably right-skewed (Figure \ref{fig:pseudoresids}). This implies that the true distribution of $Z^{*(2)}$ may follow a heavier-tailed distribution than the gamma distribution. 

We plot histograms of $Y$ and $Z^*$ separated by dive type or subdive state in Figure \ref{fig:empirical_dist}. Observations are weighted by the decoded probability of a particular hidden state, and the histogram is plotted over the emission distribution learned by the CarHHMM-DFT (Figure \ref{fig:empirical_dist}). Our results mostly support a well-specified model with the exception of $Z^{*(2)}$, which is again right-skewed. In addition, $Z^{*(1)}$ has heavy tails in subdive state 3, indicating the existence of rare events corresponding to exceptionally violent thrashing of the killer whale. These outliers are potential subjects for future study and may indicate biologically relevant phenomena such as prey capture \cite{Tennessen:2019a}. See the supplementary material for histograms for every observation and hidden state. 

\subsection{Comparison with candidate models}

The CarHMM-DFT produces very similar parameter estimates and state estimates compared to those of the CarHHMM-DFT on the fine scale. However, it fails to differentiate between short and long dives, and it therefore does not provide any information relating to the dive level Markov chain or the relationship between the dive level and the subdive level. For example, the CarHMM-DFT does not indicate that the whale is much more likely to be in subdive state 1 when engaged in longer dives than when engaged in shorter dives.

The HHMM-DFT decodes dive types and subdive states similarly to the CarHHMM-DFT, but it is less likely to categorize the behaviour at the beginning and end of dives as subdive type 3. In addition, the HHMM-DFT produces estimates of $\sigma_1^{*(1)}$, $\sigma_1^{*(2)}$, and $\sigma_1^{*(3)}$ (the standard deviation of acceleration) which are approximately 50-100 \% larger than those for the CarHHMM-DFT across all axes of acceleration. The estimated uncertainties of the estimates of $\mu_1^{*(1)}$, $\mu_1^{*(2)}$, and $\mu_1^{*(3)}$ are also less than half of those for the CarHHMM-DFT across all axes of acceleration. These findings are consistent with the tendency to overestimate variance and underestimate standard error when ignoring auto-correlation. The empirical auto-correlation of $Z^{*(1)}$ within each decoded subdive state was at least 0.5 for all acceleration axes and subdive states, and the pseudoresiduals of the HHMM-DFT show several outliers. Both of these findings suggest that the HHMM-DFT is a significantly worse fit to this data than the full CarHHMM-DFT.

The CarHHMM does not use the Fourier sums of the acceleration data, so it fails to decode the subdive states into biologically interpretable results. The pseudoresiduals corresponding to the CarHHMM also appear to be less heavy-tailed than a normal distribution. See section S-2 for a more complete set of results for each of the candidate models.