% !TeX root = ../main.tex

%%% Tables %%%

\begin{table}[ht]
\centering
\caption{Estimates with standard errors for the parameters of the distributions of dive duration $\left(Y_t\right)$, acceleration $\left(\Zone_{t,\tilde t^*}\right)$, and wiggliness $\left(\Ztwo_{t,\tilde t^*}\right)$ of the killer whale kinematic data using the full CarHHMM-DFT. The parentheses refer to standard errors estimated using the observed information matrix.}
\scalebox{0.85}{
    \begin{tabular}{ccccc}
    \multirow{2}{*}{Feature}                                                       & \multirow{2}{*}{Dive / Subdive Type} & \multicolumn{3}{c}{Parameter Estimate}        \\
                                                                                   &                                      & $\hat \mu$    & $\hat \sigma$ & $\hat \phi$   \\ \hline
    \multirow{2}{*}{Dive Duration $(s)$ -- $Y_t$}                                  & 1                                    & $27.27 (0.63)$ & $10.91 (0.56)$ & ---           \\
                                                                                   & 2                                    & $127.1 (11.3)$ & $64.1 (9.0)$ & ---           \\ \hline
    \multirow{3}{*}{$x$-Acc. $(m/s^2)$ -- $\left(\Zone_{t,\tilde t^*}\right)_x$}   & 1                                    & $0.423 (0.028)$ & $0.040 (0.001)$ & $0.966 (0.002)$ \\
                                                                                   & 2                                    & $0.210 (0.012)$ & $0.097 (0.002)$ & $0.827 (0.010)$ \\
                                                                                   & 3                                    & $0.232 (0.035)$ & $0.298 (0.010)$ & $0.605 (0.043)$ \\ \hline
    \multirow{3}{*}{$y$-Acc. $(m/s^2)$ -- $\left(\Zone_{t,\tilde t^*}\right)_y$}   & 1                                    & $0.445 (0.036)$ & $0.051 (0.001)$ & $0.966 (0.009)$ \\
                                                                                   & 2                                    & $0.438 (0.012)$ & $0.095 (0.002)$ & $0.827 (0.016)$ \\
                                                                                   & 3                                    & $0.364 (0.043)$ & $0.368 (0.012)$ & $0.605 (0.041)$ \\ \hline
    \multirow{3}{*}{$z$-Acc. $(m/s^2)$ -- $\left(\Zone_{t,\tilde t^*}\right)_z$}   & 1                                    & $-0.680 (0.041)$ & $0.058 (0.001)$ & $0.966 (0.005)$ \\
                                                                                   & 2                                    & $-0.573 (0.014)$ & $0.112 (0.002)$ & $0.827 (0.012)$ \\
                                                                                   & 3                                    & $-0.296 (0.042)$ & $0.357 (0.012)$ & $0.605 (0.039)$ \\ \hline
    \multirow{3}{*}{Wiggliness - $\Ztwo_{t,\tilde t^*}$}                           & 1                                    & $34.98 (0.38)$ & $23.85 (0.39)$ & ---           \\
                                                                                   & 2                                    & $505.8 (5.8)$ & $516.7 (7.0)$ & ---           \\
                                                                                   & 3                                    & $9770 (240)$ & $14460 (380)$ & ---           \\ \hline
    \end{tabular}
    }
    \label{table:emis_dists_CarHHMM-DFT}
\end{table}

\begin{table}[ht]
\centering
\caption{Average decoding accuracies and training times for all models used to categorize dive type and subdive state in the simulation study. Each of the four models was fit to 500 training data sets comprised of 100 simulated dives and tested on test data sets also comprised of 100 simulated dives. Reported values are averages, and $\pm$ refers to the sample standard deviation across the 500 data sets. Rows labelled Both/Both correspond to overall average decoding accuracy.}
\scalebox{0.7}{
\begin{tabular}{ccccccc}
Model                       & \multicolumn{1}{c}{Train Time (min)} & \multicolumn{1}{c}{True Dive Type} & \multicolumn{1}{c}{True Subdive State} & \multicolumn{1}{c}{Dive Accuracy} & \multicolumn{1}{c}{Subdive Accuracy}  \\ \hline
\multirow{5}{*}{CarHMM-DFT} & \multirow{5}{*}{$70 \pm 11$}   & Both                          & Both                             & -------------                     & $0.93 \pm 0.01$                       \\
                            &                                    & 1                             & 1                                & \multirow{2}{*}{-------------}    & $0.79 \pm 0.04$                       \\ 
                            &                                    & 1                             & 2                                &                                   & $0.96 \pm 0.01$                       \\ 
                            &                                    & 2                             & 1                                & \multirow{2}{*}{-------------}    & $0.92 \pm 0.01$                       \\ 
                            &                                    & 2                             & 2                                &                                   & $0.94 \pm 0.01$                       \\ \hline 
\multirow{5}{*}{HHMM-DFT}   & \multirow{5}{*}{$209 \pm 51$}   & Both                          & Both                             & $0.94 \pm 0.04$                   & $0.88 \pm 0.04$                       \\
                            &                                    & 1                             & 1                                & \multirow{2}{*}{$0.97 \pm 0.03$}    & $0.63 \pm 0.12$                       \\ 
                            &                                    & 1                             & 2                                &                                   & $0.96 \pm 0.01$                       \\ 
                            &                                    & 2                             & 1                                & \multirow{2}{*}{$0.85 \pm 0.10$}    & $0.79 \pm 0.16$                       \\ 
                            &                                    & 2                             & 2                                &                                   & $0.92 \pm 0.03$                       \\ \hline
\multirow{5}{*}{CarHHMM}    & \multirow{5}{*}{$236 \pm 52$}   & Both                          & Both                             & $0.87 \pm 0.17$                   & $0.74 \pm 0.05$                       \\
                            &                                    & 1                             & 1                                & \multirow{2}{*}{$0.87 \pm 0.21$}    & $0.77 \pm 0.21$                       \\ 
                            &                                    & 1                             & 2                                &                                   & $0.71 \pm 0.09$                       \\ 
                            &                                    & 2                             & 1                                & \multirow{2}{*}{$0.82 \pm 0.14$}    & $0.87 \pm 0.23$                       \\ 
                            &                                    & 2                             & 2                                &                                   & $0.66 \pm 0.10$                       \\ \hline
\multirow{5}{*}{CarHHMM-DFT}& \multirow{5}{*}{$132 \pm 40$}   & Both                          & Both                             & $0.94 \pm 0.04$                   & $0.93 \pm 0.01$                       \\
                            &                                    & 1                             & 1                                & \multirow{2}{*}{$0.96 \pm 0.03$}    & $0.76 \pm 0.04$                       \\ 
                            &                                    & 1                             & 2                                &                                   & $0.96 \pm 0.01$                       \\ 
                            &                                    & 2                             & 1                                & \multirow{2}{*}{$0.87 \pm 0.09$}    & $0.93 \pm 0.01$                       \\ 
                            &                                    & 2                             & 2                                &                                   & $0.93 \pm 0.01$                       \\ \hline
\end{tabular}
}

\label{table:accuracy}
\end{table}

%%% model definitions %%%

\begin{figure}[ht]
    \begin{subfigure}{\textwidth}
      \centering
      \includegraphics[width=2.75in]{../Plots/HMM.png}  
      \caption{Hidden Markov Model (\textbf{HMM})}
      \label{fig:HMM}
    \end{subfigure}
    %
    \newline
    %
    \begin{subfigure}{\textwidth}
      \centering
      \includegraphics[width=2.75in]{../Plots/CarHMM.png}  
      \caption{Conditionally Autoregressive HMM (\textbf{CarHMM})}
      \label{fig:CarHMM}
    \end{subfigure}
    %
    \newline
    %
    \begin{subfigure}{\textwidth}
      \centering
      \includegraphics[width=3in]{../Plots/HHMM.png}  
      \caption{Hierarchical HMM (\textbf{HHMM}) with traditional HMMs as the coarse- and fine-scale model}
      \label{fig:HHMM}
    \end{subfigure}
    %
    \newline
    %
    \begin{subfigure}{\textwidth}
      \centering
      \includegraphics[width=2.75in]{../Plots/HMM-DFT.png}  
      \caption{Fine-scale HMM with Discrete Fourier Transform (\textbf{HMM-DFT}) for curve $t$ (coarse-scale process omitted)}
      \label{fig:HMM-DFT}
    \end{subfigure}
    \caption{Dependence structures of a standard HMM (a) and three HMM variants (b, c, and d). Hidden state sequences are denoted as $X$ on the coarse-scale and $X^*$ on the fine scale. Observations are denoted as $Y$ on the coarse scale and $Y^*$ on the fine scale. The fine-scale observations of the HMM-DFT are transformed using a moving window and denoted as $\Z$ with corresponding hidden states $\tilde X^*$.}
    \label{fig:models}
\end{figure}

%%% data %%%

\begin{figure}[ht]
	\centering
	\includegraphics[width=5.25in]{../Plots/raw_data.png}
	\caption{Dive depth (top panel) and three-dimensional acceleration (bottom three panels) from a killer whale over approximately 5 hours. An exact physical interpretation of each of component acceleration is difficult due to variations in tag orientation. There are data gaps occurring from around $1.5$ to $1.8$ hours and from around $3.2$ to $4.5$ hours. Both data gaps were excluded from analyses.}
	\label{fig:data}
\end{figure}

%%% Case Study %%%

\begin{figure}[ht]
	\centering
	\includegraphics[width=5in]{../Plots/CarHHMM-DFT.png}
	\caption{Graphical representation of the conditionally auto-regressive hierarchical hidden Markov model with discrete Fourier transform (\textbf{CarHHMM-DFT}) used in the simulation and case study. The type of dive $t$ is denoted by $X_t$ and $Y_t$ represents the associated dive duration. The raw acceleration vector associated with dive $t$ and time stamp $t^*$ is denoted by $Y^*_{t,t^*}$. The subdive state of the killer whale during dive $t$ and window $\tilde t^*$ is denoted as $\tilde X^*_{t,\tilde t^*}$, and the corresponding transformed observation is denoted by $\Z_{t,\tilde t^*}$.}
	\label{fig:CarHHMM-DFT}
\end{figure}

\begin{figure}[ht]
    \begin{subfigure}{\textwidth}
    	\centering
    	\includegraphics[width=3in]{../Plots/2019/20190902-182840-CATs_OB_1_0_267_CarHHMM2-coarse-emissions.png}
    	\caption{Estimated Gamma densities of killer whale dive duration ($Y_t$) corresponding to dive types $X_t = 1$ and $X_t = 2$.}
    	\label{fig:coarse_emis}
    \end{subfigure}
    \newline
    \begin{subfigure}{\textwidth}
    	\centering
    	\includegraphics[width=3in]{../Plots/2019/20190902-182840-CATs_OB_1_0_267_CarHHMM2-fine-emissions.png}
    	\caption{Estimated Normal conditional densities %of the three components 
    	of killer whale acceleration $\big(\Zone_{t,\tilde t^*}|\Zone_{t,\tilde t^*-1} = \mu_A^{*(\cdot,i^*)}\big)$ plotted on a linear scale and estimated Gamma probability density of wiggliness $\big(\Ztwo_{t,\tilde t^*}\big)$ plotted on a log-log scale. These density functions correspond to subdive behaviours $\tilde{X}^*_{t,t^*} = 1,2,3$, and are identical across dive types $X_t = 1$ and $X_t = 2$. Acceleration density functions are conditioned on $\Zone_{t,\tilde t^*-1} = \mu_A^{*(\cdot,i^*)}$ since the mean of $\Zone_{t,\tilde t^*}$ depends on $\Zone_{t,\tilde t^*-1}$.}
    	\label{fig:fine_emis}
    \end{subfigure}
    \caption{Estimated probability density functions of coarse- and fine-scale emissions corresponding to observations of killer whale behaviour. Densities are estimated by fitting the CarHHMM-DFT to the case study data (see Table \ref{table:emis_dists_CarHHMM-DFT}).}
    \label{fig:emis}
\end{figure}

\begin{figure}[ht]
	\centering
	\includegraphics[width=4.75in]{../Plots/2019/20190902-182840-CATs_OB_1_0_267_CarHHMM2_decoded_dives.png}
	\caption{The $x$--component of acceleration $\left(y^*_{t,t^*}\right)_x$ (top two panels) and dive depth (bottom two panels) of a northern resident killer whale for a sequence of six selected dives. Each panel is partitioned into dives by vertical black lines. The curve colours in the first and third panels correspond to the estimated dive types while the curve colours of the second and fourth panels correspond the estimated subdive states. Both the dive types and subdive states are estimated by fitting the CarHHMM-DFT to the data and performing the forward-backward algorithm to determine the hidden state with the highest probability.}
	\label{fig:labeled_dives}
\end{figure}

\begin{figure}[ht]
    \begin{subfigure}{0.45\textwidth}
    	\centering
    	\includegraphics[width=2.25in]{../Plots/2019/20190902-182840-CATs_OB_1_0_267_CarHHMM2_pseudresids_ahat.png}
    	\caption{Histogram of pseudoresiduals of $\tilde W^*_{t,\tilde t^*}$}
    	\label{fig:pseudoresids}
    \end{subfigure}
    \begin{subfigure}{0.45\textwidth}
    	\centering
    	\includegraphics[width=2.25in]{../Plots/2019/20190902-182840-CATs_OB_1_0_267_CarHHMM2_empirical_hist_dive_duration.png}
    	\caption{Empirical distribution of $Y_t$}
    	\label{fig:empirical_dist}
    \end{subfigure}
    \caption{Pseudoresiduals of wiggliness $\left(\Phi^{-1} \left(\Pr(\Ztwo_{t,\tilde t^*} < \ztwo_{t,\tilde t^*}|Y,\tilde Y^* / \{\Ztwo_{t,\tilde t^*}\}) \right), \enspace \text{left} \right)$ plotted over a standard normal density as well as a weighted empirical distribution of dive duration ($Y_t$, right) plotted over the corresponding fitted Gamma distributions. Both plots are generated by fitting the CarHHMM-DFT to the killer whale case study data and performing the forward-backward algorithm.}
    \label{fig:model_checking}
\end{figure}

%%% simulation study %%%

\begin{figure}[ht]
    \centering
    \includegraphics[width=4.5in]{../Plots/Posterior_Coarse_States.png}
    \caption{Estimated probabilities that each dive is of type 2 for five selected dives of a simulated data set of killer whale dive behaviour. Each panel is partitioned into dives by vertical black lines. The colour of the curve corresponds to the true dive type while the colour of the background corresponds to the true subdive state. The CarHMM-DFT is omitted because it assumes that there is only one dive type.}
    \label{fig:acc_coarse}
\end{figure}

\begin{figure}[ht]
    \centering
    \includegraphics[width=4.5in]{../Plots/Posterior_Fine_States.png}
    \caption{Estimated probabilities that each window corresponds to subdive state 2 for five selected dives of a simulated data set of killer whale dive behaviour. Each panel is partitioned into dives by vertical black lines. The colour of the curve corresponds to the true subdive state while the colour of the background corresponds to the true dive type.}
    \label{fig:acc_fine}
\end{figure}