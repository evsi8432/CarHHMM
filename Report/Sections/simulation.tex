% !TeX root = ../main.tex

%\section{Simulation Study}

To evaluate the performance of each candidate model when the ground-truth is known, we perform a simulation study based on data generated from the full CarHHMM-DFT. The parameters used to generate the data are loosely based on those estimated in the case study (see able \ref{table:emis_dists_CarHHMM-DFT}), with slight modifications made for simplicity. For example, we set $\Gamma$ such that the simulated data has approximately equal numbers of short and long dives. This allows meaningful conclusions to be made for both dive types. In addition, the number subdive states is set to $N^*=2$ and $\Ztwo_{t,t^*}$ is set to a scalar. Metrics used to evaluate each model include decoding accuracy of hidden states, bias in parameter estimates, standard error of parameter estimates, and fitting times. To assess the accuracy of uncertainty estimates, we also compare the empirical standard error of each model's parameter estimates with the estimated standard error using the inverse of the observed Fisher information under that model.

\subsection{Data simulation}

We generate 500 independent data sets from the CarHHMM-DFT. Each data set consists of a sequence of 100 curves which we call a sequence of killer whale dives. Each dive can be one of $N=2$ dive types based on a Markov chain with probability transition matrix
%
$$\Gamma = \begin{pmatrix} 0.5 & 0.5 \\ 0.5 & 0.5 \end{pmatrix}.$$
%
Dive duration is gamma distributed, and the coarse-scale emission parameters $\Theta$ are
$$
    \mu^{(1)} = 20s, \quad \sigma^{(1)} = 5s, \quad
    \mu^{(2)} = 80s, \enspace \text{and} \enspace \sigma^{(2)} = 25s.
$$
%
After calculating the dive durations for all 100 dives in each data set, dive $t$ is broken into a sequence of $T^*_t = \lfloor Y_t/2 \rfloor$ two-second segments which make up the fine-scale hidden Markov model. Each two-second segment is assigned one of $N^*=2$ behaviours according to a fine-scale Markov chain $X^*_t \equiv \left(X^*_{t,1}, \ldots, X^*_{t,T^*_t} \right)$ with probability transition matrices
%
$$\Gamma^{*(1)} = \begin{pmatrix} 0.5 & 0.5 \\ 0.1 & 0.9 \end{pmatrix} \quad \text{ and } \quad \Gamma^{*(2)} = \begin{pmatrix} 0.8 & 0.2 \\ 0.3 & 0.7 \end{pmatrix}.$$ 
%
The observations $Z^*$ are generated using the following parameters:
%
\begin{gather*}
    \mu_A^{*(\cdot,1)} = 0.0 s, \enspace \sigma_A^{*(\cdot,1)} = 0.05s, \enspace \phi_A^{*(\cdot,1)} = 0.99, \\
    %
    \mu_A^{*(\cdot,2)} = 0.0 s, \enspace \sigma_A^{*(\cdot,2)} = 0.1s, \enspace \phi_A^{*(\cdot,2)} = 0.95, \\
    %
    \mu_W^{*(\cdot,1)} = 10.10, \quad \sigma_W^{*(\cdot,1)} = 3.18, \\
    %
    \mu_W^{*(\cdot,2)} = 305.94, \quad \sigma_W^{*(\cdot,2)} = 17.49.
\end{gather*}
%
Recall that $\Zone_{t,t^*}$ follows a CarHMM and is Normally distributed while $\Ztwo_{t,t^*}$ follows an HMM and is Gamma distributed. It is not possible to uniquely recreate the raw accelerometer data $Y^*$ from $Z^*$ alone, but we describe one possible mapping from $Z^*$ to $Y^*$ in the appendix. Figure \ref{fig:sim_data} shows this reconstructed sequence along with one realization of $Z^*$ for five dives of one simulated data set. 

The two dive types differ in that dives of type 1 are much shorter on average than dives of type 2. The two subdive types differ primarily due to $\mu_W^*$ and $\sigma_W^*$, both of which are much higher in subdive state 2 than subdive state 1. This corresponds to much more vigorous and variable periodic behaviour in the acceleration data.

All four candidate models (CarHHMM-DFT, HHMM-DFT, CarHHMM, and CarHMM-DFT) are fit to all 500 data sets using the Cedar Compute Canada cluster with 1 CPU and 4 GB of dedicated memory per model.

\subsection{Simulation results}

As expected, since it is the generating model, the full CarHHMM-DFT is the best-performing model. Using the forward-backward algorithm, the CarHHMM-DFT decodes the correct subdive type given the fine-scale data with an average confidence of $1 - 10^{-12}$ across all simulations. In other words, it predicts the \textit{incorrect} subdive state with an average probability of $10^{-12}$. For dive type, the average confidence was above 0.9 (see Table \ref{table:accuracy}). All parameter estimates have statistically insignificant biases except for $\hat \sigma$ and $\hat \phi$, whose MLEs are known to be biased (see section 2 of the supplementary material). Even still, these biases are the least severe for the CarHHMM-DFT among the four models. The empirical standard error of all parameter estimates ($\hat \Theta$, $\hat \Gamma$, $\hat \Theta^*$, $\hat \Gamma^*$) are well-approximated by the inverse of the observed Fisher information matrix, although the estimated standard errors tend to be slight underestimates of the empirical standard error. See Tables 6-9 of the supplementary material for more information.

The HHMM-DFT performs almost identically to the CarHHMM-DFT in most respects, including its decoding accuracy and parameter bias. However, the HHMM-DFT differed from the CarHHMM-DFT in its estimate of the standard deviation of acceleration, $\hat \sigma_A^*$. For both subdive types, $\hat \sigma_A^*$ greatly overestimates the true standard deviation. The estimated standard errors of $\hat \mu_A^*$ and $\hat \sigma_A^*$ using the observed Fisher information are both much smaller than the empirical standard error (see Table 7 of the supplementary material). This implies that the variance of acceleration can be overestimated and the standard error of the parameter estimates can be underestimated when auto-correlation is ignored. These findings are consistent with the results from the case study, where the HHMM-DFT produced higher variance estimates and narrower standard error estimates than the CarHHMM-DFT.

The CarHHMM is the worst-performing model in terms of decoding accuracy, with an average confidence below $0.9$ when determining both dive and subdive types. This result is consistent with expectations because the CarHHMM does not have access to the ``wiggles" of the fine-scale process, which are the most informative observations when determining subdive type. The CarHHMM is also much more likely to misclassify subdive type 1 than subdive type 2 (see Table \ref{table:accuracy}). The CarHHMM is also the worst of the four at estimating parameters in part due to its relatively poor decoding accuracy. The fine-scale probability transition matrices associated with dive type 2 ($\hat \Theta^{*(2)}$ and $\hat \Gamma^{*(2)}$) are especially poor estimates (see Table 9 and Figure 33 of the supplementary material).

Finally, the CarHMM-DFT is comparable to the CarHHMM-DFT in terms of decoding accuracy, parameter bias, and parameter standard error for the fine-scale observations. In addition, the time required to fit the CarHMM-DFT is less than half of that of the other models (see Table \ref{table:accuracy}). However, it lacks any hierarchical structure, so it is unable to estimate dive types. The CarHMM-DFT nonetheless fits a gamma distribution to the dive duration of \textit{all} dives. The resulting parameter estimates ($\hat \mu$ and $\hat \sigma$) are highly correlated and $\hat \sigma$ underestimates the true standard deviation of all dive types by $\approx$ 5 seconds. See Figures \ref{fig:acc_coarse} \& \ref{fig:acc_fine} for a visualization of the simulated data set as well as the decoded dive/subdive type probabilities as determined by each model.