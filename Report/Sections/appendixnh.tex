\subsection{Detailed description of data simulation from Section \ref{subsec:data_simulation}}
%\numberwithin{equation}{section}


\setcounter{equation}{4}   %  set this to the last equation number used

{\bf{I didn't like the equation numbering restarting at (1), so I used ``setcounter".}}

We easily simulate realizations of the coarse-scale HMM ($X$ and $Y$) given the parameters $\Gamma$ and $\theta$. 
To simulate data at the fine scale 
for dive $t$, recall that the fine scale model is based on a sequence of $\tilde T_t^*$ two-second windows, each containing 100 values of raw acceleration.  
 We easily generate the fine-scale hidden Markov process,  $\tilde X ^* _{t,\tilde t^*}$,
$\tilde t^*=1,\ldots,\tilde T_t^*$, that determines the sequence of underlying states in each window according to the specified parameters in $\Gamma^{*(1)}$ and $\Gamma^{*(2)}$.
 However, generating the raw acceleration data is not straightforward, since our model is formulated in terms of quantities derived from the raw data in each window, namely the average acceleration, $A_{t,\tilde t^*}$, and the wiggliness, $W_{ t,\tilde t^*}$. In our simulation study, we generate raw acceleration data so that we can visualize our results in terms of the underlying data curves for each dive.  Here, we explain how we generate the acceleration curves  so that the derived quantities, $A_{t,\tilde t^*}$ and $W_{ t,\tilde t^*}$, follow the specified model. A key component is the discrete Fourier transformation of the  100 raw acceleration values in the $\tilde{t}^*$th window of dive $t$:
\[
\hat{Y}^{*(k)}_{t,\tilde{t}^*}  \equiv DFT(Y^*_{t,100 (\tilde{t}^*-1) + 1 },\ldots, Y^*_{t,100 \tilde{t}^*})[k]
\]
for $k \ge 0$, as defined in Equation \ref{eq:DFTdef}.

 We simulate the raw acceleration data for dive $t$ in three steps: (1) simulate the average acceleration within each window $\left(\hat Y^{*(0)}_{t,\tilde t^*}\right)$, (2) simulate all other Fourier coefficients within each window $\left(\hat Y^{*(k)}_{t,\tilde t^*}, k = 1,\ldots,99\right)$, and (3) take the inverse discrete Fourier transform of $\hat{Y}^*_{t,\tilde t^*}$:
 \[
 \{Y^*_{t,100(\tilde t^* - 1) + 1},\ldots,Y^*_{t,100\tilde t^*}\} \equiv IDFT\left\{\hat{Y}^{*(0)}_{t,\tilde t^*},
 \ldots \hat{Y}^{*(99)}_{t,\tilde t^*}\right\}
    {\rm{~for~}} \tilde t^* = 1,\ldots,\tilde T^*_t.
 \]
The details of steps (1) and (2) are described below.

For step (1), we generate $\hat Y^{*(0)}_{t,1}, \ldots, \hat Y^{*(0)}_{t,\tilde T_t^*}$  as a CARHMM with underlying Markov state sequence $X^{*}_{t,1}, \ldots, X^{*}_{t,\tilde T_t^*}$ and random first emission.  Specifically, we let
   \[
    	\hat{Y}^{*(0)}_{t,1}|\tilde X^*_{t,1} = i^* ~~\sim~~ \mathcal{N} \left(0, \left(100\sigma_A^{*(\cdot,i^*)}\right)^2 \right)
    	~~{\rm{and}}
   \]
   %
     \begin{align}	
       \hat{Y}^{*(0)}_{t,\tilde t^*}|\tilde X^*_{t,\tilde t^*} = i^*,\hat{Y}^{*(0)}_{t,\tilde t^*-1}
       &~~\sim ~~\mathcal{N} \left(\phi_A^{*(\cdot,i^*)} \hat{Y}^{*(0)}_{t,\tilde t^*-1}, \left(100\sigma_A^{*(\cdot,i^*)}\right)^2 \right), \label{eqn:yhat_0} \\
        %
        &\tilde t^* = 2,\ldots, \tilde T^*_t
    	\nonumber
    \end{align}
    where $\sigma_A^{*(\cdot,1)} = 0.034s$,  $\sigma_A^{*(\cdot,2)} = 0.079s$. $\phi_A^{*(\cdot,1)} = 0.98$ and $\phi_A^{*(\cdot,2)} = 0.87$. 
  
 For step (2),
 we first construct $\hat{Y}^{*(k)}_{t,\tilde t^*}$, $k=1,\ldots, 49$, as
    \begin{equation}
        \hat{Y}^{*(k)}_{t,\tilde t^*} = a_{t,\tilde t^*}^{(k)} i\sqrt{b^{(k)}_{t,\tilde t^*}}
        \label{eqn:abYhat}
    \end{equation}
    {\bf{WHY IS THERE AN $i$ IN THE ABOVE?}}
     where the $a^{(k)}_{t,\tilde t^*}$s are independent and equal to either 1 or -1 each with probability 1/2.
    Given the fine scale states, the $b^{(k)}_{t,\tilde t^*}$s are independent  and independent of the  $a^{(k)}_{t,\tilde t^*}$s.  
   The distribution of $b^{(k)}_{t,\tilde t^*}$ is
    \begin{align}
    \begin{split}
    	b^{(k)}_{t,\tilde t^*}|\tilde X^*_{t,\tilde t^*} = 1 &~~\sim~~ {\rm{Gamma}}(16.38/k^3, 36.23) \\
    	%
    	b^{(k)}_{t,\tilde t^*}|\tilde X^*_{t,\tilde t^*} = 2  &~~\sim ~~{\rm{Gamma}}(4.20/k^3, 1825.53). \\ 
    \end{split}
    \label{eqn:bdist}
    \end{align}
    The first argument of ${\rm{Gamma}}\left(\cdot,\cdot\right)$ is the shape parameter and the second is the scale parameter. The squared magnitude of the $k^{th}$ Fourier coefficient is equal to $b^{(k)}_{t,\tilde t^*}$, which decays like $1/k^3$ to ``smooth out" the raw acceleration data.
    
   We then define the remaining 50 Fourier coefficients:
    \[
    \hat{Y}^{*(50)}_{t,\tilde t^*} = 0 {\rm{~~and ~~}}
	\hat{Y}^{*(k)}_{t,\tilde t^*} = -\hat{Y}^{*(100-k)}_{t,\tilde t^*} , k = 51,\ldots,99.
\]
   This construction guarantees that the inverse discrete Fourier transform is real-valued. 
  

We now show that this construction of the raw acceleration data  results in the distributions listed in Section \ref{subsec:data_simulation}. It suffices to show that the construction of the discrete Fourier transformations, the $\hat{Y}^{(k)}_{t,\tilde t^*}$s, yields the desired distributions.

First, since $\hat{Y}^{(0)}_{t,\tilde t^*} = \sum_{n=1}^{100} Y^*_{t,100(\tilde t^* - 1) + n} $ $=\Zone_{t,\tilde{t}^*}$, Equation (\ref{eqn:yhat_0}) implies that 
$\Zone_{t,1}, \ldots, \Zone_{t,\tilde{T}^*}$ 
follows a CARHMM with Normal emissions distributions and parameters 
 $\mu_A^{*(\cdot,1)} = \mu_A^{*(\cdot,2)} = \mu_A^{*(\cdot,i^*)} = 0$,  $\sigma_A^{*(\cdot,1)} = 0.034s$, $\phi_A^{*(\cdot,1)} = 0.98$, $\sigma_A^{*(\cdot,2)} = 0.079s$, and $\phi_A^{*(\cdot,2)} = 0.87$.

 From Equations \ref{eqn:z} and \ref{eqn:abYhat}, 
 the  wiggliness in window $\tilde t^*$  of dive $t$ is 
\[
    \Ztwo_{t,\tilde t^*} = \sum_{k=1}^{\tilde \omega} \big|\big|\hat{Y}^{(k)}_{t,\tilde t^*}\big|\big|^2 =  \sum_{k=1}^{\tilde \omega} b^{(k)}_{t,\tilde t^*}
%    \label{eqn:Wb}
\]
%
If $\tilde \omega < 50$, then $\Ztwo_{t,\tilde t^*}$ is the sum of independent Gamma-distributed random variables with identical scale parameters, so the distribution of $\Ztwo_{t,\tilde t^*}$ is also Gamma.  Thus, by Equation  \ref{eqn:bdist}
%
\[
\Ztwo_{t,\tilde t^*}|\tilde X^*_{t,\tilde t^*} = 1  ~~ \sim ~~ {\rm{Gamma}}\left(\sum_{k=1}^{\tilde \omega} 16.38/k^3 , 36.23 \right) 
\text { and }
\]
\[
\Ztwo_{t,\tilde t^*}|\tilde X^*_{t,\tilde t^*} = 2 ~~\sim~~ {\rm{Gamma}}\left(\sum_{k=1}^{\tilde \omega} 4.20/k^3 , 1825.53 \right).
\]
Setting $\tilde \omega$ to 10 and carrying out simple calculation of the mean and variance of a Gamma distribution yield $\mu_W^{*(\cdot,1)} = 23.3$, $\sigma_W^{*(\cdot,1)} = 13.0$, $\mu_W^{*(\cdot,2)} = 301.2$, and $\sigma_W^{*(\cdot,2)} = 330.1$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Likelihood of CarHHMM-DFT}

The overall likelihood of the CarHHMM-DFT model is as follows:
%
$$\calL_{\text{CarHHMM-DFT}}(\theta,\theta^*,\Gamma,\Gamma^*;y,\z) = \delta P(y_1,\z_1;\theta,\theta^*,\Gamma^*) \prod_{t=2}^T \Gamma P(y_t,\z_t;\theta,\theta^*,\Gamma^*) \mathbf{1}_N.$$
%
In particular,
%
\begin{align*}
P(y_t,\z_t;\theta,\theta^*,\Gamma^*)  = \text{diag}\Big[&f^{(1)}(y_t;\theta^{(1)})\calL_{\text{CarHMM-DFT}}\left(\theta^*,\Gamma^{*(1)};\z_t\right), \ldots , \\
&f^{(N)}(y_t;\theta^{(N)})\calL_{\text{CarHMM-DFT}}\left(\theta^*,\Gamma^{*(N)};\z_t\right) \Big],
\end{align*}
%
where $f^{(i)}(y_t;\theta^{(i)})$ is the emission distribution of dive duration given that $X_t = i$. The likelihood $\calL_{\text{CarHMM-DFT}}$ corresponds to the fine-scale model and is equal to the following:
%
$$\calL_{\text{CarHMM-DFT}}\left(\theta^{*},\Gamma^{*(i)};\z_t\right) = \delta^{*(i)} \prod_{\tilde t^* = 2}^{\tilde T^*_t} \Gamma^{*(i)} P(\z_{t,\tilde t^*}|\z_{t,\tilde t^*-1};\theta^*) \mathbf{1}_{N^*},$$
%
where $P(\z_{t,\tilde t^*}|\z_{t,\tilde t^*-1};\theta^*)$ is an $N^* \times N^*$ diagonal matrix with $(i^*,i^*)^{th}$ entry equal to $f^{*(\cdot,i^*)}(\z_{t,\tilde t^*}|\z_{t,\tilde t^*-1}; \theta^{*(\cdot,i^*)})$.
%
Recall that $f^{*(\cdot,i^*)}(\cdot|\z_{t,t^*-1}; \theta^{*(\cdot,i^*)})$ is the probability density function of $\Z_{t,\tilde t^*}$ when $\tilde X^*_{t,\tilde t^*} = i^*$ and $\Z_{t,\tilde t^*-1} = \z_{t,\tilde t^*-1}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

