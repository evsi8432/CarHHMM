\subsection{Detailed description of the data simulation in Section \ref{subsec:data_simulation}}


\setcounter{equation}{7}   %  set this to the last equation number used

We can easily simulate realizations of the coarse-scale HMM ($X$ and $Y$) given the parameters $\Gamma$ and $\theta$. For each dive $t$, we can also easily generate the fine-scale hidden Markov chain $\tilde X^*_t = \big\{\tilde X^*_{t,1},\ldots,\tilde X^*_{t,\tilde T_t^*}\big\}$ according to one of the transition probability matrices $\Gamma^{*(1)}$ or $\Gamma^{*(2)}$ depending upon the value of $X_t$. This determines the sequence of fine-scale hidden states corresponding to each window. Recall that the fine-scale model is based on a sequence of $\tilde T_t^*$ two-second windows, each containing 100 observations, and that our model is formulated in terms of quantities derived from the raw data within each window (namely, the average acceleration, $\Zone_{t,\tilde t^*}$, and wiggliness, $\Ztwo_{ t,\tilde t^*}$). Generating the raw acceleration data from $\Zone_{t,\tilde t^*}$ and $\Ztwo_{ t,\tilde t^*}$ is not straightforward. In our simulation study, we generate raw acceleration data so that we can visualize our results in terms of the underlying data curves for each dive. Here, we explain how we generate the acceleration curves so that $\Zone_{t,\tilde t^*}$ and $\Ztwo_{ t,\tilde t^*}$ both follow the specified model. A key component is the DFT of the 100 raw acceleration values in window $\tilde{t}^*$ of dive $t$,

\[
    \hat{Y}^{*(k)}_{t,\tilde{t}^*}  = \mathrm{DFT}\left\{Y^*_{t,100 (\tilde{t}^*-1) + 1 },\ldots, Y^*_{t,100 \tilde{t}^*}\right\}(k)
\]
for $k \geq 0$, as defined in Equation (\ref{eq:DFTdef}).

We simulate the raw acceleration data for dive $t$ in three steps: (1) simulate the average acceleration within each window $\left(\hat Y^{*(0)}_{t,\tilde t^*}\right)$, (2) simulate all other Fourier coefficients within each window $\left(\hat Y^{*(k)}_{t,\tilde t^*}, k = 1,\ldots,99\right)$, and (3) take the inverse discrete Fourier transform of $\hat{Y}^*_{t,\tilde t^*}$,

\[
    \{Y^*_{t,100(\tilde t^* - 1) + 1},\ldots,Y^*_{t,100\tilde t^*}\} = \mathrm{IDFT}\left\{\hat{Y}^{*(0)}_{t,\tilde t^*},
    \ldots, \hat{Y}^{*(99)}_{t,\tilde t^*}\right\}
\]
for $\tilde t^* = 1,\ldots,\tilde T^*_t$. The details of steps (1) and (2) are below.

For step (1), we generate $\hat Y^{*(0)}_{t,1}, \ldots, \hat Y^{*(0)}_{t,\tilde T_t^*}$ as a CarHMM with the underlying Markov state sequence $\tilde X^{*}_{t,1}, \ldots, \tilde X^{*}_{t,\tilde T_t^*}$ and a random first emission. Specifically, we let

\[
	\hat{Y}^{*(0)}_{t,1} \mid \tilde X^*_{t,1} = i^* ~~\sim~~ \mathcal{N} \left(100 \mu^{*(\cdot,i^*)}_A, \left(100\sigma_A^{*(\cdot,i^*)}\right)^2 \right)
\]
and
\begin{align}	
   \hat{Y}^{*(0)}_{t,\tilde t^*}\mid\tilde X^*_{t,\tilde t^*} = i^*,\hat{Y}^{*(0)}_{t,\tilde t^*-1}
   &~~\sim ~~\mathcal{N} \left(\phi_A^{*(\cdot,i^*)} \hat{Y}^{*(0)}_{t,\tilde t^*-1} + 100(1-\phi_A^{*(\cdot,i^*)}) \mu^{*(\cdot,i^*)}_A, \left(100\sigma_A^{*(\cdot,i^*)}\right)^2 \right), \label{eqn:yhat_0}
\end{align}
for $\tilde t^* = 2,\ldots, \tilde T^*_t$, where $\mu_A^{*(\cdot,i^*)}$, $\sigma_A^{*(\cdot,i^*)}$, and $\phi_A^{*(\cdot,i^*)}$ are as defined in the simulation study in Section 4.
  
For step (2), we first construct $\hat{Y}^{*(k)}_{t,\tilde t^*}$ for $k=1,\ldots, 49$, as
%
\begin{equation}
    \hat{Y}^{*(k)}_{t,\tilde t^*} = a_{t,\tilde t^*}^{(k)} i\sqrt{b^{(k)}_{t,\tilde t^*}},
    \label{eqn:abYhat}
\end{equation}
%
where the $a^{(k)}_{t,\tilde t^*}$s are independent and equal to either 1 or -1 each with probability 1/2 and $i$ is the imaginary unit. We include $i$ in Equation (\ref{eqn:abYhat}) to force all variation within a window to take the form of a sine wave, which reduces the variation between the endpoints of windows relative to a cosine wave. Given the fine scale states, the $b^{(k)}_{t,\tilde t^*}$s are independent of one another and independent of the $a^{(k)}_{t,\tilde t^*}$s.  
The distribution of $b^{(k)}_{t,\tilde t^*}$ is
   
\begin{align}
\begin{split}
	b^{(k)}_{t,\tilde t^*} \mid \tilde X^*_{t,\tilde t^*} = 1 &~~\sim~~ {\rm{Gamma}}(11.03/(k+1)^3, 15.54) \\
	%
	b^{(k)}_{t,\tilde t^*} \mid \tilde X^*_{t,\tilde t^*} = 2  &~~\sim ~~{\rm{Gamma}}(4.80/(k+1)^3, 515.38) \\ 
	%
	b^{(k)}_{t,\tilde t^*} \mid \tilde X^*_{t,\tilde t^*} = 3  &~~\sim ~~{\rm{Gamma}}(2.31/(k+1)^3, 20023.44). 
\end{split}
\label{eqn:bdist}
\end{align}

The first argument of $\mathrm{Gamma}(\cdot,\cdot)$ is the shape parameter and the second is the scale parameter. The squared magnitude of the $k^{th}$ Fourier coefficient is equal to $b^{(k)}_{t,\tilde t^*}$, which decays on the order of $1/k^3$ to ``smooth out" the raw acceleration data.

We then define the remaining 50 Fourier coefficients as $\hat{Y}^{*(50)}_{t,\tilde t^*} = 0$ and $\hat{Y}^{*(k)}_{t,\tilde t^*} = -\hat{Y}^{*(100-k)}_{t,\tilde t^*}$ for $k = 51,\ldots,99$. This guarantees that the inverse DFT is real-valued. 
  

We now show that this construction of the raw acceleration data results in the distributions listed in Section \ref{subsec:data_simulation}. It suffices to show that the construction of the DFTs, the $\hat{Y}^{(k)}_{t,\tilde t^*}$s, yields the desired distributions.

First, since $\hat{Y}^{(0)}_{t,\tilde t^*} = \sum_{n=1}^{100} Y^*_{t,100(\tilde t^* - 1) + n} $ $=100\Zone_{t,\tilde{t}^*}$, Equation (\ref{eqn:yhat_0}) implies that 
$\Zone_{t,1}, \ldots, \Zone_{t,\tilde{T}^*}$ 
follows a CarHMM with normal emission distributions and parameters as defined in the simulation study in Section 4.

From Equations (\ref{eqn:z}) and (\ref{eqn:abYhat}), 
the ``wiggliness" within window $\tilde t^*$ of dive $t$ is 

\[
    \Ztwo_{t,\tilde t^*} = \sum_{k=1}^{\tilde \omega} \big|\big|\hat{Y}^{(k)}_{t,\tilde t^*}\big|\big|^2 =  \sum_{k=1}^{\tilde \omega} b^{(k)}_{t,\tilde t^*}.
\]
%
If $\tilde \omega < 50$, then $\Ztwo_{t,\tilde t^*}$ is the sum of independent gamma distributed random variables with identical scale parameters, so the distribution of $\Ztwo_{t,\tilde t^*}$ is also gamma distributed. Thus, by Equation (\ref{eqn:bdist}),

\[
    \Ztwo_{t,\tilde t^*} \mid \tilde X^*_{t,\tilde t^*} = 1  ~~ \sim ~~ {\rm{Gamma}}\left(\sum_{k=1}^{\tilde \omega} 11.03/(k+1)^3 , 15.54 \right),
\]
%
\[
    \Ztwo_{t,\tilde t^*} \mid \tilde X^*_{t,\tilde t^*} = 2 ~~\sim~~ {\rm{Gamma}}\left(\sum_{k=1}^{\tilde \omega} 4.80/(k+1)^3 , 515.38 \right), \text{and}
\]
and
\[
    \Ztwo_{t,\tilde t^*} \mid \tilde X^*_{t,\tilde t^*} = 3  ~~ \sim ~~ {\rm{Gamma}}\left(\sum_{k=1}^{\tilde \omega} 2.31/(k+1)^3 , 20023.44 \right).
\]
Setting $\tilde \omega$ to 10 and carrying out simple calculation of the mean and variance of a gamma distribution gives the desired values for $\mu_W^{*(\cdot,i^*)}$ and $\sigma_W^{*(\cdot,i^*)}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Likelihood of the CarHHMM-DFT}

The overall likelihood of the CarHHMM-DFT is

\[\calL_{\text{CarHHMM-DFT}}(\theta,\theta^*,\Gamma,\Gamma^*;y,\z) = \delta P(y_1,\z_1;\theta,\theta^*,\Gamma^*) \prod_{t=2}^T \Gamma P(y_t,\z_t;\theta,\theta^*,\Gamma^*) \mathbf{1}_N.\]
%
where

\begin{align*}
P(y_t,\z_t;\theta,\theta^*,\Gamma^*)  = \text{diag}\Big[&f^{(1)}(y_t;\theta^{(1)})\calL_{\text{fine}}\left(\theta^*,\Gamma^{*(1)};\z_t\right), \ldots , \\
&f^{(N)}(y_t;\theta^{(N)})\calL_{\text{fine}}\left(\theta^*,\Gamma^{*(N)};\z_t\right) \Big],
\end{align*}
%
and $f^{(i)}(y_t;\theta^{(i)})$ is the emission distribution of dive duration given that $X_t = i$. The likelihood corresponding to the fine-scale model is

\[\calL_{\text{fine}}\left(\theta^{*},\Gamma^{*(i)};\z_t\right) = \delta^{*(i)} \prod_{\tilde t^* = 2}^{\tilde T^*_t} \Gamma^{*(i)} P(\z_{t,\tilde t^*} \mid \z_{t,\tilde t^*-1};\theta^*) \mathbf{1}_{N^*},\]
%
where $P(\z_{t,\tilde t^*}\mid\z_{t,\tilde t^*-1};\theta^*)$ is an $N^* \times N^*$ diagonal matrix with the $(i^*,i^*)^{th}$ entry $f^{*(\cdot,i^*)}(\z_{t,\tilde t^*}\mid\z_{t,\tilde t^*-1}; \theta^{*(\cdot,i^*)})$.
%
Recall that $f^{*(\cdot,i^*)}(\cdot \mid \z_{t,t^*-1}; \theta^{*(\cdot,i^*)})$ is the probability density function of $\Z_{t,\tilde t^*}$ when $\tilde X^*_{t,\tilde t^*} = i^*$ and $\Z_{t,\tilde t^*-1} = \z_{t,\tilde t^*-1}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

